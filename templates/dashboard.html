{% extends "base.html" %}
{% load static %}

{% block title %}Dashboard - Showroom ERP{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block extra_css %}
<style>
.dashboard-wrapper {
    position: relative;
    min-height: calc(100vh - var(--top-nav-height));
    overflow-x: hidden;
}

.dashboard-background {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: url('https://spn-sta.spinny.com/blog/20220228142009/Force-Gurkha-Header.jpg');
    background-size: cover;
    background-position: top;
    background-repeat: no-repeat;
    background-attachment: fixed;
    filter: blur(1px) brightness(0.7);
    transform: scale(1.15);
    z-index: 0;
}

.dashboard-wrapper::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, rgba(15, 23, 42, 0.75) 0%, rgba(30, 41, 59, 0.85) 50%, rgba(15, 23, 42, 0.8) 100%);
    z-index: 1;
}

.dashboard {
    position: relative;
    z-index: 2;
    width: 100%;
}

/* Glassmorphism effect for cards */
.stat-card {
    background: rgba(255, 255, 255, 0.95) !important;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1) !important;
}

.dashboard-card {
    background: rgba(255, 255, 255, 0.95) !important;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1) !important;
}

.stat-card:hover {
    background: rgba(255, 255, 255, 0.98) !important;
    transform: translateY(-4px);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15) !important;
}

.dashboard-card:hover {
    background: rgba(255, 255, 255, 0.98) !important;
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15) !important;
}

/* Ensure text is readable */
.stat-value,
.stat-label,
.card-header h2,
.data-table th,
.data-table td {
    color: var(--text-primary) !important;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .dashboard-background {
        filter: blur(8px) brightness(0.6);
        transform: scale(1.2);
    }
    
    .dashboard-wrapper::before {
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.85) 0%, rgba(30, 41, 59, 0.9) 100%);
    }
}
</style>
{% endblock %}

{% block content %}
<div class="dashboard-wrapper">
    <div class="dashboard-background"></div>
    <div class="dashboard">
    <!-- Statistics Cards -->
    <div class="stats-grid">
        <div class="stat-card stat-primary">
            <div class="stat-icon">
                <i class="fas fa-car"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-value">{{ total_cars }}</h3>
                <p class="stat-label">Total Cars</p>
            </div>
            <div class="stat-footer">
                <a href="{% url 'car-list' %}" class="stat-link">View All <i class="fas fa-arrow-right"></i></a>
            </div>
        </div>

        <div class="stat-card stat-success">
            <div class="stat-icon">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-value">{{ total_customers }}</h3>
                <p class="stat-label">Total Customers</p>
            </div>
            <div class="stat-footer">
                <a href="{% url 'customers:customer-list' %}" class="stat-link">View All <i class="fas fa-arrow-right"></i></a>
            </div>
        </div>

        <div class="stat-card stat-warning">
            <div class="stat-icon">
                <i class="fas fa-shopping-cart"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-value">{{ total_sales }}</h3>
                <p class="stat-label">Total Sales</p>
            </div>
            <div class="stat-footer">
                <a href="{% url 'sales-list' %}" class="stat-link">View All <i class="fas fa-arrow-right"></i></a>
            </div>
        </div>

        <div class="stat-card stat-info">
            <div class="stat-icon">
                <i class="fas fa-dollar-sign"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-value">₹{{ total_revenue|floatformat:2 }}</h3>
                <p class="stat-label">Total Revenue</p>
            </div>
            <div class="stat-footer">
                <a href="{% url 'sales-list' %}" class="stat-link">View Sales <i class="fas fa-arrow-right"></i></a>
            </div>
        </div>
    </div>

    <!-- Recent Activity Section -->
    <div class="dashboard-grid">
        <!-- Recent Sales -->
        <div class="dashboard-card">
            <div class="card-header">
                <h2><i class="fas fa-shopping-cart"></i> Recent Sales</h2>
                <a href="{% url 'sales-list' %}" class="view-all-link">View All</a>
            </div>
            <div class="card-body">
                {% if recent_sales %}
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Customer</th>
                                    <th>Car</th>
                                    <th>Price</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for sale in recent_sales %}
                                <tr>
                                    <td>{{ sale.customer.first_name }} {{ sale.customer.last_name }}</td>
                                    <td>{{ sale.car.year }} {{ sale.car.make }} {{ sale.car.model }}</td>
                                    <td>₹{{ sale.sale_price|floatformat:2 }}</td>
                                    <td>{{ sale.sale_date|date:"M d, Y" }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-shopping-cart"></i>
                        <p>No sales yet</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Recent Cars -->
        <div class="dashboard-card">
            <div class="card-header">
                <h2><i class="fas fa-car"></i> Recent Cars</h2>
                <a href="{% url 'car-list' %}" class="view-all-link">View All</a>
            </div>
            <div class="card-body">
                {% if recent_cars %}
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Car</th>
                                    <th>Year</th>
                                    <th>Price</th>
                                    <th>Mileage</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for car in recent_cars %}
                                <tr>
                                    <td>{{ car.make }} {{ car.model }}</td>
                                    <td>{{ car.year }}</td>
                                    <td>₹{{ car.price|floatformat:2 }}</td>
                                    <td>{{ car.mileage|floatformat:0 }} mi</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-car"></i>
                        <p>No cars added yet</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
</div>
{% endblock %}

